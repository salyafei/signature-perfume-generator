<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>Orissa • Fragrance Personality Quiz</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Lora&family=Inter&display=swap" rel="stylesheet" />
  <style>
    :root {
      --turquoise: #40E0D0;
      --ivory: #FFFFF0;
      --charcoal: #333333;
    }
    html { box-sizing: border-box; }
    *, *:before, *:after { box-sizing: inherit; margin:0; padding:0; }
    body {
      font-family: 'Lora','Inter',sans-serif;
      background: var(--ivory);
      color: var(--charcoal);
      max-width: 960px;
      margin: 0 auto;
      padding: 24px;
    }
    h1,h2 {
      font-family: 'Playfair Display', serif;
      color: var(--turquoise);
      text-align: center;
      margin-bottom: 16px;
    }
    .logo { text-align: center; margin-bottom: 32px; }
    .logo img { max-width: 150px; }
    .lang-btn {
      border: 2px solid var(--turquoise);
      background: transparent;
      color: var(--turquoise);
      padding: 6px 14px;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
      float: right;
      margin-top: -16px;
    }
    .clearfix::after { content: ''; display: table; clear: both; }
    .question {
      background: #fff;
      border-left: 6px solid var(--turquoise);
      padding: 16px;
      margin-bottom: 24px;
      border-radius: 6px;
    }
    .question p { font-weight: bold; margin-bottom: 8px; }
    label { display: block; margin: 6px 0; cursor: pointer; }
    input[type="radio"], input[type="date"] { margin-right: 8px; }
    button.generate {
      display: block;
      margin: 24px auto;
      background: var(--turquoise);
      color: #fff;
      border: 0;
      padding: 12px 28px;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
    }
    #progress {
      text-align: center;
      margin-bottom: 16px;
      font-size: 0.9em;
      color: var(--charcoal);
    }
    #result {
      background: #fff;
      border-left: 6px solid var(--turquoise);
      margin-top: 36px;
      padding: 24px;
      border-radius: 8px;
    }
    .rtl { direction: rtl; text-align: right; }
    .blend-list { list-style: none; padding-left: 0; }
    .blend-list li { margin-bottom: 4px; }
  </style>
</head>
<body>
  <button class="lang-btn" id="langToggle" aria-label="Toggle language">AR / EN</button>
  <div class="clearfix"></div>
  <div class="logo"><img src="logo.png" alt="Orissa Logo" /></div>
  <h1 id="title">
    Discover Your Signature Fragrance<br />
    <span style="font-size:.6em">اكتشف عطرك الشخصي</span>
  </h1>
  <div id="progress">Question <span id="currentQ">1</span> of 20</div>
  <form id="quizForm">
    <div class="question" role="region" aria-labelledby="birthDate">
      <p id="birthDate"><strong>Optional: Enter your birth date for a personalized touch</strong></p>
      <input type="date" id="birthDate" name="birthDate">
    </div>
    <div id="questions"></div>
    <button type="button" class="generate" id="genBtn">
      Generate Result<br /><span style="font-size:.8em">توليد النتيجة</span>
    </button>
  </form>
  <div id="result"></div>
  <script>
    const Quiz = {
      lang: "en",
      questionsData: [
        {
          en: "If you were to host a gathering, which atmosphere would you create?",
          ar: "إذا كنت ستستضيف تجمعًا، فما الأجواء التي ستنشئها؟",
          options: [
            ["Candlelit salon with soft music", "صالون مضاء بالشموع وموسيقى هادئة", ["elegant", "serenity", "oriental", "romance"]],
            ["Bold pop-art gallery with bright lights", "معرض فن بوب جريء وأضواء ساطعة", ["bold", "joy", "citrus", "celebration"]],
            ["Secluded reading nook by the fireplace", "ركن قراءة معزول بجانب الموقد", ["playful", "reflection", "woody", "reflection"]],
            ["Sunset beach bonfire with close friends", "موقد شاطئي عند الغروب مع الأصدقاء", ["exotic", "joy", "citrus", "childhood"]],
            ["Vibrant rooftop dance floor under stars", "حلبة رقص نابضة على السطح تحت النجوم", ["bold", "passion", "spicy", "celebration"]],
            ["Lush garden brunch at sunrise", "غداء في حديقة مورقة عند شروق الشمس", ["elegant", "serenity", "floral", "nature"]]
          ]
        },
        {
          en: "When you look out your window in the morning, you feel drawn to…",
          ar: "عندما تنظر من نافذتك في الصباح، ما الذي يجذبك؟",
          options: [
            ["Misty dew on rose petals", "ندى ضبابي على بتلات الورود", ["sensual", "reflection", "floral", "nature"]],
            ["Sunbeams dancing on wooden floors", "أشعة الشمس ترقص على الأرضيات الخشبية", ["elegant", "joy", "woody", "reflection"]],
            ["Hush of empty city streets", "صمت شوارع المدينة الفارغة", ["mysterious", "serenity", "oriental", "reflection"]],
            ["Hum of a busy café", "ضجيج مقهى مزدحم", ["refreshing", "joy", "citrus", "childhood"]],
            ["Sparkle of waves on water", "لمعان الأمواج على الماء", ["refreshing", "serenity", "aquatic", "nature"]],
            ["Glow of lanterns in an alley", "توّهج الفوانيس في زقاق", ["mysterious", "intrigue", "oriental", "travel"]]
          ]
        },
        {
          en: "Which childhood memory makes you smile most vividly?",
          ar: "أي ذكرى من طفولتك تجعلك تبتسم أكثر؟",
          options: [
            ["Baking cookies with family", "خبز البسكويت مع العائلة", ["sensual", "joy", "gourmand", "childhood"]],
            ["Building forts outdoors", "بناء الحصون في الهواء الطلق", ["playful", "confidence", "spicy", "childhood"]],
            ["Bedtime stories by lamplight", "قصص قبل النوم بضوء المصباح", ["elegant", "serenity", "oriental", "reflection"]],
            ["Running barefoot on wet grass", "الجري حافي القدمين على العشب المبلل", ["refreshing", "joy", "citrus", "nature"]],
            ["Blowing bubbles in the park", "نفخ الفقاعات في الحديقة", ["playful", "joy", "floral", "childhood"]],
            ["Riding a carousel at a fair", "ركوب الدوّامة في المهرجان", ["whimsical", "joy", "gourmand", "celebration"]]
          ]
        },
        {
          en: "If you could step into any painting, which scene appeals?",
          ar: "إذا استطعت الدخول في أي لوحة، أي مشهد يجذبك؟",
          options: [
            ["Moonlit forest with silvery mist", "غابة مضيئة بضوء القمر وضباب فضي", ["mysterious", "serenity", "woody", "nature"]],
            ["Blazing sunset over desert dunes", "غروب مشع فوق كثبان الصحراء", ["bold", "passion", "spicy", "travel"]],
            ["Stately manor’s rose garden", "حديقة الورود في قصر فخم", ["elegant", "romance", "floral", "romance"]],
            ["Blue-white seascape at dawn", "منظر بحري أزرق-أبيض عند الفجر", ["refreshing", "serenity", "citrus", "nature"]],
            ["Colorful spice market at noon", "سوق توابل ملون عند الظهر", ["exotic", "confidence", "spicy", "travel"]],
            ["Quiet temple courtyard", "فناء معبد هادئ", ["elegant", "reflection", "oriental", "reflection"]]
          ]
        },
        {
          en: "Your ideal weekend morning involves…",
          ar: "صباح عطلة نهاية الأسبوع المثالي لديك يتضمن…",
          options: [
            ["Journaling by a window", "تدوين اليوميات بجانب النافذة", ["elegant", "serenity", "woody", "reflection"]],
            ["High-intensity workout", "تمرين عالي الشدة", ["bold", "power", "spicy", "celebration"]],
            ["Long forest hike", "نزهة طويلة في الغابة", ["exotic", "serenity", "woody", "nature"]],
            ["Brunch on a sunny terrace", "غداء على شرفة مشمسة", ["sensual", "joy", "floral", "romance"]],
            ["Dancing to upbeat tunes", "الرقص على نغمات مرحة", ["playful", "joy", "citrus", "celebration"]],
            ["Calligraphy in cozy studio", "ممارسة الخط في استوديو مريح", ["elegant", "reflection", "oriental", "reflection"]]
          ]
        },
        {
          en: "Which book genre do you gravitate toward?",
          ar: "أي نوع من الكتب تميل إليه؟",
          options: [
            ["Classic romance", "الرومانسية الكلاسيكية", ["sensual", "romance", "floral", "romance"]],
            ["Adventure thrillers", "روايات التشويق والمغامرة", ["bold", "passion", "spicy", "travel"]],
            ["Mysteries & gothic", "قصص الغموض والقوطية", ["mysterious", "intrigue", "oriental", "reflection"]],
            ["Travel memoirs", "مذكرات السفر", ["exotic", "confidence", "woody", "travel"]],
            ["Light comedies", "كوميديا خفيفة", ["playful", "joy", "citrus", "celebration"]],
            ["Philosophical poetry", "شعر فلسفي", ["elegant", "serenity", "oriental", "reflection"]]
          ]
        },
        {
          en: "In a movie, you most enjoy scenes that are…",
          ar: "في فيلم، تستمتع بالمشاهد التي تكون…",
          options: [
            ["Intimate by candlelight", "حوارات حميمة بضوء الشموع", ["sensual", "romance", "oriental", "romance"]],
            ["Explosive action abroad", "مشاهد حركة انفجارية في الخارج", ["bold", "passion", "spicy", "travel"]],
            ["Haunting close-ups", "لقطات جوية مقربة مخيفة", ["mysterious", "intrigue", "oriental", "reflection"]],
            ["Reflective nature montages", "مونتاجات طبيعية تأملية", ["elegant", "serenity", "woody", "nature"]],
            ["Joyful musicals", "مقاطع موسيقية مرحة", ["playful", "joy", "citrus", "celebration"]],
            ["Surreal dreamscapes", "مناظر أحلام سريالية", ["exotic", "intrigue", "oriental", "reflection"]]
          ]
        },
        {
          en: "Your signature jewelry piece would be…",
          ar: "قطعة المجوهرات المميزة لديك ستكون…",
          options: [
            ["Rose-gold locket", "قلادة من الوردي الذهبي", ["elegant", "romance", "floral", "romance"]],
            ["Statement cuff", "سوار بارز", ["bold", "power", "oriental", "celebration"]],
            ["Oxidized pendant", "قلادة مؤكسدة", ["mysterious", "intrigue", "woody", "reflection"]],
            ["Wooden bead bracelet", "سوار خرز خشبي", ["exotic", "nature", "woody", "nature"]],
            ["Turquoise ring", "خاتم تركواز", ["playful", "joy", "citrus", "celebration"]],
            ["Silver band", "خاتم فضي", ["elegant", "serenity", "woody", "reflection"]]
          ]
        },
        {
          en: "Which light feels most comforting?",
          ar: "أي ضوء تشعر أنه أكثر راحة؟",
          options: [
            ["Soft candle glow", "توهج الشموع الناعم", ["sensual", "serenity", "oriental", "romance"]],
            ["Neon club strobes", "أضواء نيون نادي", ["bold", "excitement", "spicy", "celebration"]],
            ["Moody lamps", "مصابيح درامية", ["mysterious", "intrigue", "woody", "reflection"]],
            ["Cool daylight", "ضوء النهار البارد", ["refreshing", "serenity", "citrus", "nature"]],
            ["Warm Edison bulbs", "مصابيح إديسون الدافئة", ["elegant", "joy", "woody", "romance"]],
            ["Lantern at twilight", "مصباح في الغسق", ["exotic", "intrigue", "oriental", "reflection"]]
          ]
        },
        {
          en: "Your ideal invite would mention…",
          ar: "دعوتك المثالية ستذكر…",
          options: [
            ["Dusk gathering", "تجمع عند الغسق", ["sensual", "romance", "oriental", "romance"]],
            ["All-night party", "حفلة طوال الليل", ["bold", "celebration", "spicy", "celebration"]],
            ["Secret lounge", "صالون سري", ["mysterious", "intrigue", "woody", "reflection"]],
            ["Beachside picnic", "نزهة على الشاطئ", ["exotic", "serenity", "woody", "nature"]],
            ["Rooftop dance", "رقص على السطح", ["playful", "joy", "citrus", "celebration"]],
            ["Garden poetry", "شعر في الحديقة", ["elegant", "reflection", "floral", "nature"]]
          ]
        },
        {
          en: "If you could bottle one emotion, it would be…",
          ar: "إذا استطعت تعبئة عاطفة واحدة، فستكون…",
          options: [
            ["Serene contentment", "راحة هادئة", ["elegant", "serenity", "woody", "reflection"]],
            ["Fierce confidence", "ثقة قوية", ["bold", "confidence", "spicy", "celebration"]],
            ["Deep intrigue", "فضول عميق", ["mysterious", "intrigue", "oriental", "reflection"]],
            ["Pure joy", "فرح خالص", ["playful", "joy", "citrus", "childhood"]],
            ["Adventurous zeal", "حماس مغامر", ["exotic", "passion", "spicy", "travel"]],
            ["Romantic nostalgia", "حنين رومانسي", ["sensual", "romance", "floral", "romance"]]
          ]
        },
        {
          en: "When choosing a meal, you’re most drawn to…",
          ar: "عند اختيار وجبة، ما الذي يجذبك؟",
          options: [
            ["Artful plating", "تقديم فني", ["elegant", "serenity", "oriental", "reflection"]],
            ["Spicy bold flavors", "نكهات حارة وجريئة", ["bold", "passion", "spicy", "celebration"]],
            ["Rich slow-cooked stews", "أطباق مطبوخة ببطء وغنية", ["sensual", "gourmand", "woody", "childhood"]],
            ["Fresh farm-to-table", "طازج من المزرعة", ["refreshing", "joy", "citrus", "nature"]],
            ["Sweet playful desserts", "حلويات حلوة ومرحة", ["playful", "joy", "floral", "celebration"]],
            ["Comfort classics", "أطباق الراحة التقليدية", ["elegant", "joy", "woody", "reflection"]]
          ]
        },
        {
          en: "In conversation, you prefer topics that are…",
          ar: "في الحديث، تفضل المواضيع التي تكون…",
          options: [
            ["Philosophical & reflective", "فلسفية وتأملية", ["elegant", "reflection", "woody", "reflection"]],
            ["Challenging & ambitious", "تحدي وطموح", ["bold", "confidence", "spicy", "celebration"]],
            ["Mysterious & speculative", "غامضة ومتنبئة", ["mysterious", "intrigue", "oriental", "reflection"]],
            ["Heartwarming & sincere", "دافئة وصادقة", ["sensual", "joy", "floral", "romance"]],
            ["Energetic & fun", "نشيطة وممتعة", ["playful", "joy", "citrus", "celebration"]],
            ["Cultural & worldly", "ثقافية وعالمية", ["exotic", "excitement", "woody", "travel"]]
          ]
        },
        {
          en: "Which piece of music stirs you most?",
          ar: "أي قطعة موسيقية تحركك أكثر؟",
          options: [
            ["Soft piano nocturne", "مقطوعة بيانو هادئة", ["elegant", "serenity", "woody", "reflection"]],
            ["Driving rock anthem", "أنشودة روك قوية", ["bold", "passion", "spicy", "celebration"]],
            ["Eerie ambient track", "مقطوعة بيئية غامضة", ["mysterious", "intrigue", "oriental", "reflection"]],
            ["Gentle acoustic ballad", "أغنية بلادي هادئة", ["sensual", "romance", "floral", "romance"]],
            ["Lively dance beat", "إيقاع رقص حيوي", ["playful", "joy", "citrus", "celebration"]],
            ["Haunting world chant", "ترنيمة عالمية مخيفة", ["exotic", "intrigue", "oriental", "travel"]]
          ]
        },
        {
          en: "If you gifted someone a place to stay, it would be…",
          ar: "إذا أهديت مكان إقامة، فسيكون…",
          options: [
            ["Serene mountain cabin", "كوخ جبلي هادئ", ["mysterious", "serenity", "woody", "nature"]],
            ["Chic urban loft", "شقة حضرية أنيقة", ["bold", "confidence", "citrus", "celebration"]],
            ["Hidden historic villa", "فيلا تاريخية مخفية", ["mysterious", "intrigue", "oriental", "reflection"]],
            ["Beachside bungalow", "بنغل على الشاطئ", ["refreshing", "joy", "aquatic", "nature"]],
            ["Trendy boutique hostel", "نزل بوتيكي عصري", ["playful", "joy", "floral", "celebration"]],
            ["Luxurious spa resort", "منتجع سبا فاخر", ["elegant", "romance", "oriental", "romance"]]
          ]
        },
        {
          en: "Which pastime speaks to your soul?",
          ar: "أي هواية تنادي روحك؟",
          options: [
            ["Painting or sketching", "الرسم أو التخطيط", ["elegant", "reflection", "floral", "reflection"]],
            ["Competitive sports", "رياضات تنافسية", ["bold", "power", "spicy", "celebration"]],
            ["Creative writing", "الكتابة الإبداعية", ["mysterious", "intrigue", "oriental", "reflection"]],
            ["Gardening or birdwatching", "البستنة أو مراقبة الطيور", ["sensual", "serenity", "woody", "nature"]],
            ["Party-hosting & socializing", "استضافة الحفلات والتواصل الاجتماعي", ["playful", "joy", "citrus", "celebration"]],
            ["Meditation & yoga", "التأمل واليوغا", ["elegant", "serenity", "woody", "reflection"]]
          ]
        },
        {
          en: "At a party, you’re most often found…",
          ar: "في الحفلة، تجد نفسك غالبًا…",
          options: [
            ["In a quiet corner chatting", "في زاوية هادئة تتحدث", ["elegant", "reflection", "oriental", "reflection"]],
            ["Leading the dance floor", "تقود حلبة الرقص", ["bold", "passion", "spicy", "celebration"]],
            ["Observing from shadows", "ترصد من الظلال", ["mysterious", "intrigue", "woody", "reflection"]],
            ["Helping the host", "مساعدة المضيف", ["sensual", "joy", "floral", "romance"]],
            ["Capturing candid photos", "التقاط صور عفوية", ["playful", "joy", "citrus", "childhood"]],
            ["Mingling across groups", "التواصل مع الجميع", ["exotic", "confidence", "woody", "travel"]]
          ]
        },
        {
          en: "Your perfect getaway includes…",
          ar: "عطلتك المثالية تتضمن…",
          options: [
            ["A silent retreat", "منتجع صامت", ["mysterious", "serenity", "woody", "reflection"]],
            ["Multi-city tour", "جولة متعددة المدن", ["bold", "confidence", "citrus", "travel"]],
            ["Stay in ancient citadel", "إقامة في قلعة قديمة", ["mysterious", "intrigue", "oriental", "reflection"]],
            ["Nature lodge by a lake", "منتجع طبيعي بجانب البحيرة", ["refreshing", "joy", "aquatic", "nature"]],
            ["Beachside festival", "مهرجان على الشاطئ", ["playful", "joy", "citrus", "celebration"]],
            ["Historic mansion stay", "إقامة في قصر تاريخي", ["elegant", "romance", "floral", "romance"]]
          ]
        },
        {
          en: "Which fabric texture feels most luxurious?",
          ar: "أي نسيج يبدو الأكثر فخامة؟",
          options: [
            ["Silky satin", "ساتان حريري", ["sensual", "romance", "oriental", "romance"]],
            ["Embossed leather", "جلد منقوش", ["bold", "power", "spicy", "celebration"]],
            ["Raw velvet", "مخمل خام", ["mysterious", "intrigue", "woody", "reflection"]],
            ["Crisp linen", "كتان مقرمش", ["refreshing", "serenity", "citrus", "nature"]],
            ["Breathable cotton", "قطن تنفسي", ["playful", "joy", "floral", "childhood"]],
            ["Cashmere wool", "صوف الكشمير", ["elegant", "serenity", "woody", "reflection"]]
          ]
        },
        {
          en: "When you reminisce, you recall…",
          ar: "عندما تسترجع الذكريات، تتذكر…",
          options: [
            ["First meaningful conversation", "أولى محادثة ذات مغزى", ["elegant", "romance", "oriental", "reflection"]],
            ["A triumphant achievement", "إنجاز انتصاري", ["bold", "confidence", "spicy", "celebration"]],
            ["A secret you never shared", "سر لم تشاركه", ["mysterious", "intrigue", "woody", "reflection"]],
            ["A peaceful childhood afternoon", "عصر طفولي هادئ", ["refreshing", "joy", "citrus", "childhood"]],
            ["A spontaneous road trip", "رحلة طريق عفوية", ["exotic", "joy", "citrus", "travel"]],
            ["A milestone celebration", "احتفال بإنجاز", ["sensual", "celebration", "floral", "celebration"]]
          ]
        }
      ],
      categories: {
        style: ["elegant", "bold", "sensual", "playful", "mysterious", "exotic", "refreshing"],
        emotion: ["serenity", "confidence", "joy", "passion", "intrigue", "excitement", "reflection"],
        family: ["oriental", "citrus", "woody", "floral", "spicy", "gourmand", "aquatic"],
        memory: ["romance", "celebration", "reflection", "nature", "childhood", "travel"]
      },
      score: { style: {}, emotion: {}, family: {}, memory: {} },
      pyramidNotes: {
        oriental: [
          ["Saffron", "Cardamom", "Pink Pepper", "Star Anise", "Clove"], // Top (5)
          ["Myrrh", "Frankincense", "Labdanum", "Rose Absolute", "Jasmine Sambac"], // Heart (5)
          ["Benzoin", "Oud", "Tonka Bean", "Amber Resin", "Vanilla Absolute"] // Base (5)
        ],
        citrus: [
          ["Bergamot", "Lemon Zest", "Grapefruit", "Mandarin", "Yuzu", "Lime Peel"], // Top (6)
          ["Neroli", "Orange Blossom", "Petitgrain", "Lemongrass", "Verbena"], // Heart (5)
          ["Musk", "Amber", "Litsea Cubeba", "Cedrat", "Bitter Orange"] // Base (5)
        ],
        woody: [
          ["Cedarwood", "Pine Needle", "Juniper Berry", "Eucalyptus", "Cypress"], // Top (5)
          ["Sandalwood", "Rosewood", "Guaiac Wood", "Hinoki Wood", "Teak"], // Heart (5)
          ["Vetiver", "Patchouli", "Ebony Wood", "Agarwood", "Driftwood"] // Base (5)
        ],
        floral: [
          ["Jasmine", "Ylang-Ylang", "Lilac", "Freesia", "Magnolia", "Neroli"], // Top (6)
          ["Rose", "Tuberose", "Peony", "Gardenia", "Heliotrope", "Osmanthus"], // Heart (6)
          ["Iris", "Violet", "Mimosa", "White Musk", "Orchid"] // Base (5)
        ],
        spicy: [
          ["Black Pepper", "Coriander", "Nutmeg", "Ginger Root", "Wasabi"], // Top (5)
          ["Cinnamon Bark", "Clove Bud", "Saffron Thread", "Pimento Berry", "Star Anise"], // Heart (5)
          ["Oud Smoke", "Cumin Seed", "Frankincense Resin", "Myrrh Gum", "Leather Accord"] // Base (5)
        ],
        gourmand: [
          ["Caramel", "Honey", "Praline", "Toffee", "Maple Syrup"], // Top (5)
          ["Chocolate", "Coffee Bean", "Hazelnut", "Almond Milk", "Chestnut Cream"], // Heart (5)
          ["Tonka Bean", "Cocoa Absolute", "Vanilla Pod", "Salted Caramel", "Brown Sugar"] // Base (5)
        ],
        aquatic: [
          ["Sea Salt", "Calone", "Aquatic Accord", "Melon", "Cucumber"], // Top (5)
          ["Water Lily", "Lotus Blossom", "Marine Accord", "Seaweed", "Blue Chamomile"], // Heart (5)
          ["Ambergris", "Driftwood", "Moss", "Mineral Musk", "Ozone"] // Base (5)
        ]
      },
      seasonMapping: {
        spring: { family: "floral", note: ["Jasmine", "Rose", "Musk"], emotion: "joy" },
        summer: { family: "citrus", note: ["Bergamot", "Neroli", "Musk"], emotion: "refreshing" },
        autumn: { family: "woody", note: ["Cedarwood", "Sandalwood", "Vetiver"], emotion: "reflection" },
        winter: { family: "oriental", note: ["Amber", "Myrrh", "Benzoin"], emotion: "serenity" }
      },
      monthNames: {
        1: "January Glow", 2: "February Mist", 3: "March Bloom", 4: "April Dew",
        5: "May Blossom", 6: "June Radiance", 7: "July Spark", 8: "August Dusk",
        9: "September Amber", 10: "October Haze", 11: "November Ember", 12: "December Frost"
      },

      init() {
        // Initialize scores
        for (let cat in this.categories) {
          this.categories[cat].forEach(trait => this.score[cat][trait] = 0);
        }
        // Bind event listeners
        document.getElementById('langToggle').onclick = () => this.toggleLanguage();
        document.getElementById('genBtn').onclick = () => this.generateResult();
        document.getElementById('quizForm').addEventListener('change', () => this.updateProgress());
        this.renderQuestions();
      },

      toggleLanguage() {
        this.lang = this.lang === "en" ? "ar" : "en";
        this.renderQuestions();
      },

      renderQuestions() {
        try {
          const wrap = document.getElementById("questions");
          wrap.innerHTML = "";
          document.body.className = this.lang === "ar" ? "rtl" : "";
          document.getElementById("title").innerHTML = this.lang === "ar"
            ? "اكتشف عطرك الشخصي<br /><span style='font-size:.6em'>Discover Your Signature Fragrance</span>"
            : "Discover Your Signature Fragrance<br /><span style='font-size:.6em'>اكتشف عطرك الشخصي</span>";

          this.questionsData.forEach((q, i) => {
            const div = document.createElement("div");
            div.className = "question";
            div.setAttribute("role", "region");
            div.setAttribute("aria-labelledby", `q${i}`);
            const text = this.lang === "ar" ? q.ar : q.en;
            div.innerHTML = `<p id="q${i}"><strong>${i + 1}. ${text}</strong></p>`;
            q.options.forEach((opt, idx) => {
              const label = this.lang === "ar" ? opt[1] : opt[0];
              div.insertAdjacentHTML("beforeend",
                `<label><input type="radio" name="q${i}" value="${idx}" aria-label="${label}"> ${label}</label>`
              );
            });
            wrap.appendChild(div);
          });
          this.updateProgress();
        } catch (e) {
          console.error('Error rendering questions:', e);
        }
      },

      updateProgress() {
        const answered = document.querySelectorAll('input[type="radio"]:checked').length;
        document.getElementById('currentQ').textContent = answered + 1;
      },

      getSeason(birthDate) {
        const month = new Date(birthDate).getMonth() + 1;
        if (month >= 3 && month <= 5) return "spring";
        if (month >= 6 && month <= 8) return "summer";
        if (month >= 9 && month <= 11) return "autumn";
        return "winter";
      },

      generateResult() {
        try {
          // Validate all questions answered
          const unanswered = this.questionsData.find((q, i) => !document.querySelector(`input[name="q${i}"]:checked`));
          if (unanswered) {
            alert(this.lang === "ar" ? "يرجى الإجابة على جميع الأسئلة" : "Please answer all questions");
            return;
          }

          // Reset scores
          for (let cat in this.score) {
            for (let t in this.score[cat]) this.score[cat][t] = 0;
          }

          // Core scoring
          this.questionsData.forEach((q, i) => {
            const sel = document.querySelector(`input[name="q${i}"]:checked`);
            if (!sel) return;
            const [s, e, f, m] = q.options[+sel.value][2];
            this.score.style[s] += 1;
            this.score.emotion[e] += 1;
            this.score.family[f] += 1;
            this.score.memory[m] += 1;
          });

          // Birth date adjustment
          const birthDate = document.getElementById('birthDate').value;
          if (birthDate) {
            const season = this.getSeason(birthDate);
            const { family, emotion } = this.seasonMapping[season];
            this.score.family[family] += 1; // Subtle boost
            this.score.emotion[emotion] += 0.5;
          }

          // Calculate percentages
          const result = {};
          for (let cat in this.score) {
            const entries = Object.entries(this.score[cat]).sort((a, b) => b[1] - a[1]);
            const [[t1, n1], [t2, n2], [t3, n3]] = entries;
            const sum3 = n1 + n2 + n3 || 1;
            result[cat] = [
              { trait: t1, percent: Math.round(100 * n1 / sum3) },
              { trait: t2, percent: Math.round(100 * n2 / sum3) },
              { trait: t3, percent: 100 - Math.round(100 * n1 / sum3) - Math.round(100 * n2 / sum3) }
            ];
          }

          // Generate perfume name
          const perfumeName = birthDate
            ? `${this.monthNames[new Date(birthDate).getMonth() + 1]} ${result.family[0].trait.charAt(0).toUpperCase() + result.family[0].trait.slice(1)}`
            : `Essence ${result.family[0].trait.charAt(0).toUpperCase() + result.family[0].trait.slice(1)}`;

          // Generate narrative
          const narrative = birthDate
            ? `Your ${this.getSeason(birthDate)} birth infuses this fragrance with ${this.seasonMapping[this.getSeason(birthDate)].family} elegance, blending ${result.emotion[0].trait} and ${result.style[0].trait} charm.`
            : `A unique fragrance crafted to reflect your ${result.emotion[0].trait} and ${result.style[0].trait} personality.`;

          // Build blends HTML
          let blendsHTML = `<h2>${perfumeName}</h2><p>${narrative}</p>`;
          ["style", "emotion", "family", "memory"].forEach(cat => {
            blendsHTML += `<h3>${this.lang === "ar"
              ? { "style": "أسلوب", "emotion": "العاطفة", "family": "عائلة العطر", "memory": "الذاكرة" }[cat]
              : cat.charAt(0).toUpperCase() + cat.slice(1)}</h3><ul class="blend-list">`;
            result[cat].forEach(({ trait, percent }) => {
              blendsHTML += `<li>${trait} — ${percent}%</li>`;
            });
            blendsHTML += `</ul>`;
          });

          // Dynamic fragrance pyramid
          const famBlend = result.family;
          const layers = ["Top Note", "Heart Note", "Base Note"];
          blendsHTML += `<h3>${this.lang === "ar" ? "هرم العطر" : "Fragrance Pyramid"}</h3>`;
          layers.forEach((layer, i) => {
            blendsHTML += `<p><strong>${this.lang === "ar"
              ? ["المقدمة", "القلب", "القاعدة"][i]
              : layer}:</strong> `;
            blendsHTML += famBlend.map(({ trait, percent }) => {
              const note = this.pyramidNotes[trait][i][Math.floor(Math.random() * this.pyramidNotes[trait][i].length)];
              return `${note} (${percent}%)`;
            }).join(" • ");
            blendsHTML += `</p>`;
          });

          document.getElementById("result").innerHTML = blendsHTML;
        } catch (e) {
          console.error('Error generating result:', e);
          document.getElementById("result").innerHTML = this.lang === "ar"
            ? "حدث خطأ، حاول مرة أخرى" : "An error occurred, please try again";
        }
      }
    };

    document.addEventListener("DOMContentLoaded", () => Quiz.init());
  </script>
</body>
</html>
